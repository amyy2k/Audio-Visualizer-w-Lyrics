<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wireframe Audio Visualizer</title>
  <link href="https://fonts.googleapis.com/css2?family=Quantico&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: linear-gradient(to bottom, black, white);
      font-family: 'Quantico', sans-serif;
      letter-spacing: 1px;
      color: white;
    }

    #controls {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 10;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    #playPauseBtn {
      background: transparent;
      color: white;
      border: none;
      padding: 6px 12px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }

    #playPauseBtn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    #trackSelect {
      background: black;
      color: white;
      border: 1px solid white;
      padding: 6px 8px;
      font-size: 14px;
    }

    #seekBar {
      width: 200px;
      height: 6px;
      appearance: none;
      background: white;
      cursor: pointer;
    }

    #seekBar::-webkit-slider-thumb,
    #seekBar::-moz-range-thumb {
      height: 14px;
      width: 14px;
      background: white;
      border-radius: 50%;
      border: none;
    }

    #lyrics {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      text-align: center;
      white-space: pre-line;
      opacity: 0;
      transition: opacity 1s ease;
      z-index: 5;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="controls">
    <select id="trackSelect">
      <option value="Joji - Die For You.mp3">Joji - Die For You</option>
      <option value="Porter Robinson - Sad Machine.mp3">Porter Robinson - Sad Machine</option>
      <option value="Radiohead - All I Need.mp3">Radiohead - All I Need</option>
      <option value="Cynthoni - Dork After Dark.mp3">Cynthoni - Dork After Dark</option>
      <option value="Cynthoni - Lychee Ice.mp3">Cynthoni - Lychee Ice</option>
    </select>
    <button id="playPauseBtn">▶</button>
    <input type="range" id="seekBar" value="0" min="0" max="100" step="0.1">
  </div>

  <div id="lyrics"></div>
  <audio id="audio"></audio>

  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js"
      }
    }
  </script>

  <script type="module">
    import * as THREE from 'three';

    const audio = document.getElementById('audio');
    const playPauseBtn = document.getElementById("playPauseBtn");
    const trackSelect = document.getElementById("trackSelect");
    const seekBar = document.getElementById("seekBar");
    const lyricsDiv = document.getElementById("lyrics");

    let scene, camera, renderer, terrain, analyser, dataArray;
    let lyricsTimer;
    let currentLyrics = [];

    const lyricsMap = {
      "Joji - Die For You.mp3": [
        [0, "Swear I couldn't sleep a wink last night"],
        [6, "No point in turnin' off the lights"],
        [11, "Not the same without your head on my shoulders"],
        [17, "Growin' pains, but I don't wanna get older"],
        [23, "Almost like we left it all on read"],
        [28, "Couple feelings never laid to rest"],
        [32, "Didn't know that the party was over"],
        [37, "And it's true that I need you here closer"],
        [43, "Burning photos"],
        [46, "Had to learn to let go"],
        [49, "I used to be"],
        [52, "Somebody in another skin (another skin)"],
        [57, "I heard that you're happy without me"],
        [63, "And I hope it's true"],
        [67, "It kills me a little, that's okay"],
        [72, "Cause I'd die for you"],
        [76, "You know I'd still die for you"],
        [82, "I hope you're getting everything you needed"],
        [88, "Found the puzzle piece and feel completed"],
        [93, "Just wanted you to know every reason"],
        [97, "Hope you really know that I mean that"],
        [101, "I couldn't see"],
        [104, "The forest from the trees"],
        [107, "Only time we speak"],
        [109, "Is in my dreams"],
        [113, "Burning photos"],
        [116, "Had to learn to let go"],
        [119, "I used to be"],
        [121, "Somebody in another skin (another skin)"],
        [126, "I heard that you're happy without me"],
        [132, "And I hope it's true"],
        [136, "It kills me a little, that's okay"],
        [141, "Cause I'd die for you"],
        [145, "You know I'd still die for you"]
      ],
      "Porter Robinson - Sad Machine.mp3": [
        [0, "Is anyone there?"],
        [3, "(Oh hi!)"],
        [6, "Who survived?"],
        [8, "Somebody new?"],
        [11, "Anyone else but you"],
        [16, "On a lonely night"],
        [19, "Was a blinding light"],
        [22, "A hundred leaders, would be borne of you"],
        [28, "And though I know, since you've awakened her again"],
        [33, "She depends on you, she depends on you"],
        [38, "She'll go alone and never speak of this again"],
        [44, "We depend on you, we depend on you"],
        [49, "I don't know much about your life beyond these walls"],
        [55, "The fleeting sense of love within these God forsaken halls"],
        [61, "And I can hear it in his voice in every call"],
        [66, "This girl who slept a hundred years has something after all"],
        [72, "And though I know, since you've awakened her again"],
        [76, "She depends on you, she depends on you"],
        [80, "I'll go alone and never speak of you again"],
        [85, "We depend on you, we depend on you"],
        [90, "She'll go alone, and never speak of this again"],
        [94, "We depend on you, we depend (I depend) on you"]
      ],
      "Radiohead - All I Need.mp3": [
        [0, "I'm the next act waiting in the wings"],
        [5, "I'm an animal trapped in your hot car"],
        [10, "I am all the days that you choose to ignore"],
        [15, "You are all I need"],
        [18, "You're all I need"],
        [22, "I'm in the middle of your picture"],
        [26, "Lying in the reeds"],
        [30, "I am a moth who just wants to share your light"],
        [36, "I'm just an insect trying to get out of the night"],
        [42, "I only stick with you because there are no others"],
        [48, "You are all I need"],
        [51, "You're all I need"],
        [55, "I'm in the middle of your picture"],
        [59, "Lying in the reeds"],
        [64, "It's all wrong, it's all wrong, it's all wrong"],
        [69, "It's alright, it's alright, it's alright"],
        [74, "It's all wrong, it's alright"],
        [77, "It's alright, it's alright"]
      ]
    };

    const cols = 64, rows = 64, terrainWidth = 300, terrainDepth = 800;
    const geometry = new THREE.PlaneGeometry(terrainWidth, terrainDepth, cols - 1, rows - 1);
    geometry.rotateX(-Math.PI / 2);
    const material = new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true });
    terrain = new THREE.Mesh(geometry, material);

    function initScene() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 10, 100);
      camera.lookAt(0, 50, 0);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);
      scene.add(terrain);

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      animate();
    }

    function showLyricsTimed(trackName) {
      clearInterval(lyricsTimer);
      const lyrics = lyricsMap[trackName];
      if (!lyrics) {
        lyricsDiv.textContent = "";
        lyricsDiv.style.opacity = 0;
        return;
      }

      let index = 0;
      lyricsTimer = setInterval(() => {
        if (!audio.paused && index < lyrics.length && audio.currentTime >= lyrics[index][0]) {
          lyricsDiv.textContent = lyrics[index][1];
          lyricsDiv.style.opacity = 1;
          setTimeout(() => lyricsDiv.style.opacity = 0, 4000);
          index++;
        }
      }, 300);
    }

    function loadTrack(filename) {
      audio.src = "audio/" + filename;
      audio.load();
      audio.play();
      playPauseBtn.textContent = '⏸';
      showLyricsTimed(filename);

      const audioCtx = new AudioContext();
      const source = audioCtx.createMediaElementSource(audio);
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
      dataArray = new Uint8Array(analyser.frequencyBinCount);
      source.connect(analyser);
      analyser.connect(audioCtx.destination);
    }

    playPauseBtn.onclick = () => {
      if (audio.paused) {
        audio.play();
        playPauseBtn.textContent = '⏸';
      } else {
        audio.pause();
        playPauseBtn.textContent = '▶';
      }
    };

    trackSelect.onchange = () => {
      lyricsDiv.textContent = "";
      lyricsDiv.style.opacity = 0;
      loadTrack(trackSelect.value);
    };

    seekBar.addEventListener('input', () => seekBar.dragging = true);
    seekBar.addEventListener('change', () => {
      audio.currentTime = (seekBar.value / 100) * audio.duration;
      seekBar.dragging = false;
    });

    audio.onended = () => playPauseBtn.textContent = '▶';

    function animate() {
      requestAnimationFrame(animate);
      if (analyser && dataArray) {
        analyser.getByteFrequencyData(dataArray);
        const pos = terrain.geometry.attributes.position;
        const halfCols = Math.floor(cols / 2);
        for (let z = rows - 1; z > 0; z--) {
          for (let x = 0; x < cols; x++) {
            const i = z * cols + x;
            const prev = (z - 1) * cols + x;
            pos.array[i * 3 + 1] = pos.array[prev * 3 + 1];
          }
        }
        for (let x = 0; x < cols; x++) {
          const i = x;
          const mirrorIndex = x < halfCols ? x : cols - x - 1;
          const bin = Math.floor((mirrorIndex / halfCols) * dataArray.length);
          const magnitude = dataArray[Math.min(bin, dataArray.length - 1)] / 255;
          pos.array[i * 3 + 1] = magnitude * 60;
        }
        pos.needsUpdate = true;
        if (!seekBar.dragging && audio.duration) {
          seekBar.value = (audio.currentTime / audio.duration) * 100;
        }
      }
      renderer.render(scene, camera);
    }

    window.onload = () => {
      initScene();
      loadTrack(trackSelect.value);
    };
  </script>
</body>
</html>
