<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Wireframe Audio Visualizer</title>
  <link href="https://fonts.googleapis.com/css2?family=Quantico&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: 'Quantico', sans-serif;
      letter-spacing: 1px;
      color: white;
    }

    #controls {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 10;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    #playPauseBtn {
      background: transparent;
      color: white;
      border: none;
      padding: 6px 12px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }

    #playPauseBtn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    #trackSelect {
      background: black;
      color: white;
      border: 1px solid white;
      padding: 6px 8px;
      font-size: 14px;
      font-family: 'Quantico', sans-serif;
    }

    #seekBar {
      width: 200px;
      height: 6px;
      appearance: none;
      background: white;
      cursor: pointer;
    }

    #seekBar::-webkit-slider-thumb,
    #seekBar::-moz-range-thumb {
      height: 14px;
      width: 14px;
      background: white;
      border-radius: 50%;
      border: none;
    }

    #lyrics {
      position: fixed;
      top: 20%;
      width: 100%;
      text-align: center;
      font-size: 24px;
      transform: translateY(-50%);
      pointer-events: none;
      z-index: 5;
      opacity: 0.8;
    }
  </style>
</head>

<body>
  <div id="controls">
    <select id="trackSelect">
      <option value="Cynthoni - Dork After Dark.mp3">Cynthoni - Dork After Dark</option>
      <option value="Cynthoni - Lychee Ice.mp3">Cynthoni - Lychee Ice</option>
      <option value="Joji - Die For You.mp3">Joji - Die For You</option>
      <option value="Porter Robinson - Sad Machine.mp3">Porter Robinson - Sad Machine</option>
      <option value="Radiohead - All I Need.mp3">Radiohead - All I Need</option>
    </select>
    <button id="playPauseBtn">▶</button>
    <input type="range" id="seekBar" value="0" min="0" max="100" step="0.1">
  </div>

  <div id="lyrics"></div>
  <audio id="audio"></audio>

  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js"
      }
    }
  </script>

  <script type="module">
    import * as THREE from 'three';

    let scene, camera, renderer, terrain, analyser, dataArray;
    const audio = document.getElementById('audio');
    const playPauseBtn = document.getElementById("playPauseBtn");
    const trackSelect = document.getElementById("trackSelect");
    const seekBar = document.getElementById("seekBar");
    const lyricsDiv = document.getElementById("lyrics");

    const lyricsMap = {
      "Joji - Die For You.mp3": "Sometimes, sometimes...",
      "Porter Robinson - Sad Machine.mp3": "Is anyone there?",
      "Radiohead - All I Need.mp3": "I'm the next act, waiting in the wings"
    };

    const cols = 64, rows = 64, terrainWidth = 300, terrainDepth = 800;
    const geometry = new THREE.PlaneGeometry(terrainWidth, terrainDepth, cols - 1, rows - 1);
    geometry.rotateX(-Math.PI / 2);

const material = new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true });

    terrain = new THREE.Mesh(geometry, material);

    init();

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 10, 100);
      camera.lookAt(0, 50, 0);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);
      scene.add(terrain);

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      animate();
    }

    trackSelect.onchange = () => loadTrack(trackSelect.value);

    playPauseBtn.onclick = () => {
      if (audio.paused) {
        audio.play();
        playPauseBtn.textContent = '⏸';
      } else {
        audio.pause();
        playPauseBtn.textContent = '▶';
      }
    };

    audio.onended = () => {
      playPauseBtn.textContent = '▶';
    };

    seekBar.addEventListener('input', () => {
      seekBar.dragging = true;
    });

    seekBar.addEventListener('change', () => {
      audio.currentTime = (seekBar.value / 100) * audio.duration;
      seekBar.dragging = false;
    });

    function loadTrack(filename) {
      audio.src = filename;
      audio.load();
      audio.play();
      playPauseBtn.textContent = '⏸';
      lyricsDiv.textContent = lyricsMap[filename] || '';

      const audioCtx = new AudioContext();
      const source = audioCtx.createMediaElementSource(audio);
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
      dataArray = new Uint8Array(analyser.frequencyBinCount);

      source.connect(analyser);
      analyser.connect(audioCtx.destination);
    }

    function animate() {
      requestAnimationFrame(animate);

      if (analyser && dataArray) {
        analyser.getByteFrequencyData(dataArray);
        const pos = terrain.geometry.attributes.position;
        const halfCols = Math.floor(cols / 2);

        for (let z = rows - 1; z > 0; z--) {
          for (let x = 0; x < cols; x++) {
            const i = z * cols + x;
            const prev = (z - 1) * cols + x;
            pos.array[i * 3 + 1] = pos.array[prev * 3 + 1];
          }
        }

        for (let x = 0; x < cols; x++) {
          const i = x;
          const mirrorIndex = x < halfCols ? x : cols - x - 1;
          const bin = Math.floor((mirrorIndex / halfCols) * dataArray.length);
          const clampedBin = Math.min(bin, dataArray.length - 1);
          const magnitude = dataArray[clampedBin] / 255;
          pos.array[i * 3 + 1] = magnitude * 60;
        }

        pos.needsUpdate = true;

        if (!seekBar.dragging && audio.duration) {
          seekBar.value = (audio.currentTime / audio.duration) * 100;
        }
      }

      renderer.render(scene, camera);
    }

    window.onload = () => {
      loadTrack(trackSelect.value);
    };
  </script>
</body>

</html>
